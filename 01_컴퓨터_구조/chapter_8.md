### 병렬 처리

- 다수의 프로세서들이 여러 개의 프로그램들 혹은 한 프로그램의 분할된 부분들을 분담하여 동시에 처리하는 기술

- 병렬처리를 위한 선결 조건

  - 많은 수의 프로세서들로 하나의 시스템을 구성할 수 있도록 작고 저렴하며 고속인 프로세서들의 사용이  가능해야함
  - 한  프로그램을 여러개의 작은 부분으로 분할하는 것이 가능해야 하며, 분할된 부분들을 병렬로 처리한 결과가 전체 프로그램을 순차적으로 처리한 경우와 동일한 결과를 얻을 수 있어야 함

- 야기되는 새로운 문제들

  - 문제 분할 : 병렬처리를 위하여 문제(프로그램)를 여러 개로 나누는 것
  - 프로세서간 통신 : 분할된 부분을 나누어 처리하는 프로세서간의 데이터 교환을 위해 메커니즘 필요

- 병렬처리의 단위

  - 작업 단위의 병렬성 : 독립적인 작업 프로그램 단위로 병렬 처리
  - 태스크 단위 병렬성 : 하나의 큰 작업을 기능에 따라 분할한 작은 프로그램(태스크)  단위로 병렬처리 (로봇 제어 프로그램 > 팔과 다리들을 제어하는 4개의 태스크로 분할 후, 병렬 처리 > 프로세서들간의 정보 교환 필요)

  - 스레드 단위 병렬성 : 동시에 처리될 수 있는 가장 작은 크기의 독립적인 단위 프로그램인 스레드 단위의 병렬 처리
  - 명령어 단위 병렬성 : 데이터 의존성이 존재하지 않는 여러 개의 명령어들을 동시에 수행하는 병렬처리

- ### 병렬컴퓨터의 분류(Flynn의 분류)

  ![1554165303273](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554165303273.png)

  - 명령어 스트림 : 프로세서에 의해 실행되기 위하여 순서대로 나열된 명령어 코드들의 집합
  - 데이터 스트림 : 명령어들을 실행하는데 필요한 순서대로 나열된 데이터들의 집합
    - 단일 명령어 스트림 - 단일 데이터 스트림
      - 한번에 한 개씩 명령어와 데이터를 순서대로 처리하는 단일 프로세서 시스템
      - 파이프라이닝, 슈퍼스칼라 구조를 이용
    - 단일 명령어 스트림 - 복수 데이터 스트림(GPU에서 사용)
      - 배열 프로세서
      - 여러개의 프로세싱 유니트들로 구성되고, PU들의 동작은 모두 하나의 제어 유니트에 의해 통제
      - 모든 PU들은 하나의 명령어 스트림을 실행
      - 데이터 스트림은 여러개를 동시에 처리
    - 복수 명령어 스트림 - 단일 데이터 스트림
      - N개의 프로세서들이 서로 다른 명령어를 실행하지만 처리하는 데이터 스트림은 한 개 > 비현실적임
    - 복수 명령어 스트림 - 복수 데이터 스트림
      - N개의 프로세서들이 서로 다른 명령어들과 데이터들을 처리
      - 프로세서간의 상호작용 정도에 따라 두 가지로 분류
        - 밀결합 시스템(슈퍼컴퓨터)
          - 공유 기억장치 구조
          - 다중 프로세서 시스템
        - 소결함 시스템(네트워크)
          - 지역 기억장치를 가진 독립적인 컴퓨터 모듈로 구성
          - 프로세서간 통신은 메세지 전송 방식 이용
          - 다중 컴퓨터 시스템

- 기억장치 액세스 모델에 따른 분류

  - 균일 기억장치 액세스 모델(UMA)

    ![1554165655042](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554165655042.png)

    - 모든 프로세서들이 상호 연결망에 의해 접속된 주기억장치를 공유
    - 프로세서들은 주기억장치의 어느 영역이든 액세스할 수 있으며, 그에 걸리는 시간이 동일하다.
    - 장점 : 하드웨어가 간단하고 프로그래밍이 용이하다.
    - 단점 : 공유 지원에 대한 경합이 높아지기에 시스템 크기에 한계가 있다.

  - 불균일 기억장치 액세스(NUMA)

    ![1554165802593](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554165802593.png)

    - UMA 모델의 한계를 극복하고 더 큰 규모의 시스템을 구성하기 위한 모델
    - 다수의 UMA 모델들이 상호 연결망에 접속
    - 분산 공유 기억장치 구조
    - 기억장치의 액세스 시간은 기억장치의 위치에 따라 달라짐
      - 지역 기억장치 액세스
      - 전역 기억장치 액세스
      - 원격 기억장치 액세스

  - 무 원격 기억장치 액세스 모델(MORMA)

    - 원격 기억장치는 직접 액세스할 수 없는 시스템 구조
    - 프로세서들과 기억장치들은 메세지 전송을 지원하는 상호연결망으로 접속
    - 분산 기억장치 시스템이라고 부름



### 다중 프로세서

- 시스템 구성 방법에 따른 분류

  - 대칭적 다중  프로세서

    - 64개 이하의 프로세서들을 가지는 중대형급 시스템
    - 완전 공유 구조 : 프로세서들이 시스템 내의 모든 자원들을 공유
    - 하나의 OS만 존재
    - 대칭적
      - 모든 프로세서들이 필요시 직접 OS 코드 수행
      - 모든 프로세서들이 자원들을 동등한 권한으로 사용
    - 능력이 비슷한 프로세서들로 구성
    - 메모리와 입출력장치를 공유하고 상호 연결망에 의해 접속
    - 모든 프로세서들은 동등한 권한을 가지며, 같은 수준의 기능들을 수행
    - 통신은 공유 기억장치를 기용
    - 공유 자원의 경합으로 인해 시스템 크기의 한계

    ![1554166313598](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554166313598.png)

  - 대규모 병렬 프로세서

    - 무공유 구조를 기반으로 하는 대규모 병렬처리 시스템
    - 수백 혹은 수천개의 프로세싱 노드들로 구성
    - 간단한 구조의 노드 프로세서 사용
    - 복잡도 높은 상호 연결망 이용
    - 통신은 메세지 패싱 방식 이용
    - 작은 커널 수준의 노드 OS 탑재

  - 캐쉬 일관성 NUMA

    - 독립적인 노드들(UMA or NUMA)이 상호 연결망에 의해 접속
    - 모든 노드들의 캐시 및 주기억장치들 사이에 데이터 일관성 유지
    - 모든 기억장치들이 전역 주소공간을 가지는 분산 공유 기억장치시스템으로 구성
    - 장점 : SW 변경없이 SMP보다 더 큰 시스템 구축 가능

    ![1554166594236](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554166594236.png)

  - 분산시스템

    - 독립적인 노드들이 전통적인 네트워크에 의해 접속
    - 노드들 간의 정보교환 혹은 병렬처리를 수행할 때만 네트워크를 이용하여 통신
    - 노드 : PC, 워크스테이션, SMP, MPP, 혹은 그들의 조합

  - 클러스터 컴퓨터

    - PC, 워크스테이션을 모아서 사용하는 컴퓨터
    - 네트워크 : 고속 LAN, 혹은 네트워크 스위치
    - 모든 시스템 자원들을 단일 시스템 이미지로 통합
    - 주요 장점 : 저렴한 비용으로 병렬처리시스템 구축  가능, 결함 대체 용이 > 가용성 향상

- ### 다중 프로세서 시스템 구조

  - MIMD 조직으로서,  여러개의 프로세서들이 비동기적으로 프로그램을 실행하는 시스템

  - 기억장치 모듈을 사용하는 방식에 따른 분류

    - 공유 기억장치 시스템

      - 밀결합 구조로서, 주기억장치가 어느 한 프로세서에 속해있지않고 모든 프로세서들에 의해 공유

      - 상호 연결 구조

        - 버스

          - 공유 버스

            - 하드웨어가 매우 간단

            - 버스 경합으로 인한 지연 시간 증가

              - 버스의 전송 속도를 높이거나 캐시를 사용하여 성능 저하를 보완

              ![1554167241746](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554167241746.png)

          - 다중 버스

            - 버스 경합을 줄이기 위하여 버스의 수를 증가
            - 계층버스 구조 : 용도가 다른 여러 계층의 버스들을 사용

            ![1554167252664](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554167252664.png)

        - 크로스바 스위치

          - 프로세서들과 기억장치 사이의 완전 연결성
          - 비용이 많이들고 하드웨어가 복잡

          ![1554167308364](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554167308364.png)

        - 다단계 상호연결망

          - 크로스바 스위치의 기본 개념을 이용하면서도 하드웨어 복잡성을 감소시킨 상호 연결망
          - ex)오메가 네트워크

          ![1554167395429](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554167395429.png)

      - 장점

        - 공통으로 사용하는 데이터들이 공유 기억장치에 저장되므로 별도의 프로세서간 데이터 교환 매커니즘이 필요하지 않음
        - 프로그램 실행시간 동안에 각 프로세서들이 처리할 작업들을 동적으로 균등하게 할당할 수 있으므로 프로세서 이용률은 극대화 할 수 있어서 시스템 효율을 높일 수 있다.

      - 단점

        - 프로세서들과 기억장치들 간의 통로 상에 통신량이 많아지기 때문에 경합으로 인한 지연 시간이 길어질 수 있음
        - 두 개 이상의 프로세서들이 공유자원(기억장치 모듈 또는 입출력장치)을 동시에 사용하려는 경우 한 개 이외의 프로세서들은 대기해야함
          - 프로세서 수가 증가해도 선형적 성능 향상 불가능(캐시 기억장치의 사용으로 보완)

- ### 분산 기억장치 시스템

  - 분산 기억장치 시스템 구조

    - 소결합 구조

    - 각 프로세서가 자신의 지역 기억장치를 소유

    - 다른 프로세서들과의 통신은 메세지 전송 이용

    - 장점 : 공유 자원에 대한 경합 감소

    - 단점 : 통신 프로토콜에 의한 지연 시간 증가

    - 네트워크 지름 : 네트워크 내에서 가장 멀리 떨어져 있는 노드들 간의 거리(즉, 링크의 수)

    - 선형 배열 구조

      - 네트워크 지름이 N-1로서, 다른 구조들에 비해 가장 길다
      - 버스 구조 보다 동시성이 더 높다
      - 통신 시간이 노드들 간의 거리에 따라 서로 다르며, 노드의 수가 많아지면(N이 커지면) 통신 시간이 매우 길어진다

      ![1554167927049](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554167927049.png)

    - 링 구조

      - 네트워크 지름
        - 각 링크가 양방향성 이면 N/2
        - 단 방향성이면 N-1
      - 변형 구조 : 코달 원형
        - 링크의 수가 증가될수록 네트워크 지름은 감소
        - d(degree) : 각 노드가 가지는 링크의 수

    - 트리 구조

      - 층의 수를 k라고 할때 N = (2^k -1)개의 노드들 접속
      - 네트워크 지름 2(k-1)
      - 시스템 요소들의 수가 증가함에 따라 성능이 선형적으로 향상

    - 팻 트리 구조

      - 상위 층으로 올라갈수록 노드들간의 통신 채널 수 증가
      - 트리 구조에서 상위 층으로 올라갈수록 통신량이 많아져서 채널이 병목이 되는 문제점을 해결

    - 매시 구조

    - 토러스 네트워크

      - 원형 구조와 매쉬 구조가 혼합된 구조로 확장 용이

    - 하이퍼큐브 네트워크

      - 상호 연결 함수

      ![1554168895113](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554168895113.png)

      - 4차원도 가능

        ![1554169230995](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554169230995.png)

### 그래픽처리유니트(GPU)

![1554170387353](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554170387353.png)

- GPU는 CPU와 다르게 병렬구조를 갖고 있다.

- 기본 아키텍쳐

  - CPU 변수 > GPU 처리 > CPU가 처리된 내용을 처리

- SP(Scalar Processor) : GPU의 가장 기본적인 단위 1SP = 4스레드

  ![1554170474642](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554170474642.png)

  - Register와 Floating Point 연산, Integer 연산, ALU(Arithmetic Logic Unit)로 구성

- SM : 8개의 SP로 구성 GPU는 SM의 집합으로 구성되어있다.

  - 32개의 스레드가 있으며 32개의 스레드는 워프라는 단위로 불린다.

    - 1 SM = 8 SP = 1개의 SP에는 4개의 스레드 = 32 스레드

  - ##### GPU는 1SM 단위로 동작한다.

  ![1554170761055](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554170761055.png)

- GPU

  - Host Interface: CPU로부터 Instruction과 데이터를 받고 컨트롤 신호 송수신
  - RAM : Instruction과 데이터를 저장
  - L2 Cache : RAM의 효율을 높임
  - GigaThread : CPU로부터 받은 instruction을 SM에게 분배

  ![1554170881214](C:\Users\TAE\AppData\Roaming\Typora\typora-user-images\1554170881214.png)