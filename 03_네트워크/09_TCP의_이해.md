- ### 전송 계층의 기능

  - 데이터 링크 계층과 유사
    - 오류 제어, 흐름 제어, 데이터 순서화 등 제공
  - 데이터 링크 계층과의 차이점
    - 데이터 링크 계층은 물리적으로 1:1 연결된 호스트 사이의 전송
    - 전송 계층은 논리적으로 1:1 연결된 호스트 사이의 전송
  - 흐름 제어
    - 기본 목적을 비롯해 유사한 점이 많지만 계층 2와는 다른 버퍼 관리 방법 필요
    - 수신자가 송신자의 전송 속도보다 느리게 수신 -> 버퍼 용량 초과로 데이터 분실 -> 타임아웃 기능을 통한 재전송 유발 
    - 수신자가 슬라이딩 윈도우 프로토콜의 윈도우 하단 값을 조정
    - 송신자가 보낼 수 있는 패킷의 한계 설정
  - 오류 제어
    - 데이터 변형, 데이터 분실 오류시 재전송 기능으로 복구
    - 수신자의 요구(NAK) 또는 송신자의 판단(타임 아웃)
    - 선로 오류보다 각 계층의 소프트웨어 동작 과정 중에 분실하는 경우가 대부분
      - 네트워크 계층의 기능적 한계
      - 잘못된 위치/경로 정보
  - 분할과 병합
    - 상위계층에서 요구한 데이터 크기가 전송계층에서 처리할 수 있는 크기보다 큰 경우
    - 분할(Segmentation)
    - 병합(Reassembly)
  - 서비스 프리미티브
    - 네트워크 계층의 경우 대부분 비연결형 서비스 프리미티브가 정의
    - 전송계층의 경우 비연결형과 신뢰성이 향상된 연결형 서비스 모두 제공



- ### 전송계층 설계 시 고려사항

  - 주소 표현
    - 예 : 네트워크 계층의 호스트 IP 주소 + 전송 계층의 포트 번호 조합
    - TSAP(Transport Service Access Point)
    - 구조적 표현
      - 여러 개의 계층적 필드로 구분 (각 필드는 상하 계층 관계를 나타냄)
      - 예: 대한민국:서울:한국대학교:정보통신공학과:네트워크연구실:홍길동:50
      - 포트번호 : 하나의 컴퓨터에 다수의 포트 존재(통신 프로세스 구별)
    - 비구조적 표현
      - 값만 해석해서는 논리적인 위치 파악 불가
      - 값 자체에 위치가 아닌, 다른 중요한 정보를 담고 있는 경우
        - 초등학교의 반 번호, 일련 번호
    - IP 주소
      - 네트워크와 호스트의 계층적인 특성
      - 도메인 주소는 구조적 특징
        - www.korea.co.kr
      - 위치 정보와 관련해서는 비구조적 특징
        - 주소를 바탕으로 위치를 파악할 수 없음

  - 멀티플렉싱(Multiplexing)
    - 개별적으로 설정된 TPDU(Transport Protocol Data Unity)의 주소가 동일한 경우 하나의 가상회선에 실어 보내는 것이 유리
    - 종류
      - 상향
        - 다수의 전송 계층 연결을 하부의 네트워크 계층에서 하나의 연결로 지원
        - 네트워크 계층의 가산 회선 연결의 개수를 줄일 수 있음
      - 하향
        - 하나의 전송 연결에 대하여 네트워크 계층에서 다수의 가상회선을 지원
        - 멀티미디어 전송에 유리 : 음성, 영상, 자막 등을 별도의 가상 회선으로 처리
  - 연결 설정
    - 개념적으로 양자 합의가 필요
      - 한쪽의 연결 설정 요구 : Conn_Req
      - 상대방의 연결 수락 응답 : Conn_Ack
    - 2단계 연결설정
      - 최소한의 단계
      - 수신단에서 거부 가능
    - 실제로 프리미티브 전달 과정에서의 분실, 변형, 복사 가능성이 있으므로 이러한 문제들을 고려해야 함
    - 3단계 설정 (3-Way Handshake)
      - 세 번째의 Data_Req는 Conn_Ack에 대한 응답 기능도 수행
      - 보낼 데이터가 없는 경우 Conn_Ack(y,x)에 대한 응답을 따로 보내야 함
  - 연결 해제
    - 일방적 연결 해제
      - 어느 한쪽의 Disc_req 로 전체 연결 해제
      - 상대방이 송신할 데이터가 남아있어도 종료
    - 점진적 연결 해제
      - 논리적으로 2개의 단방향 연결을 지원
      - 어느 한쪽에서 해제 요청을 하는 경우 그 프로세스가 송신하는 연결만 해제
      - 양쪽 모두 Disc_req를 전송해야 해제가 됨



- ### TCP

  - Transport Control Protocol
  - 주요 기능
    - 연결형 서비스 제공
    - 전이중(full-duplex) 방식의 양방향 가상회선 제공
    - 신뢰성 있는 데이터 전송 보장
  - 일반적으로 전송계층 프로토콜은 운영체제 내부 기능으로 구현
  - TCP에서는 데이터를 세그먼트(segment)라는 블록 단위로 분할하여 전송
    - 블록 크기는 네트워크 부하 정도, 윈도우 크기 등에 영향
    - 가변 크기
    - 세그먼트당 순서번호를 부여하지 않고, 세그먼트에 실어 보내는 데이터 바이트 수를 순서번호에 반영
  - 상위계층에서는 연결형 서비스와 비연결형 서비스를 선택하여 전송 계층 프로토콜(TCP, UDP) 선택
    - 연결 유무, 신뢰성 외에도 해당 전송계층을 선택했을 때 각 응용 프로그램에서 수행해야 하는 기능DP 대해서 이해 필요
  - 데이터 링크 계층에는 다양한 네트워크 인터페이스 존재



- ### TCP의 연결 설정

  - 3 단계 설정 (3-way handshake)
    - A 프로세스의 연결설정 요청
      - 임의의 순서번호(10) 선택한 후 SYN(연결설정 요청) 전송
    - B 프로세스의 응답
      - 10에 대한 응답(ACK)과 임의로 선택한 순서번호 (50)의 SYN 전송
    - A 프로세스가 현재 보낼 데이터가 없는 경우
      - 50에 대한 응답(ACK) 전송
  - 정상적인 데이터 전송
    - 3번째 연결설정 단계에서부터 데이터 전송 가능
    - 데이터 크기만큼 순서번호 증가
    - 흐름제어는 윈도우 필드 이용
  - 데이터 전송 오류
    - 동일한 순서번호
      - 중복으로 판단하고 폐기
    - 순서번호가 빠지는 경우
      - 분실로 판단
    - NAK는 지원하지 않음
      - 분실 또는 변형시 수신 프로세스는 응답을 하지 않고, 송신측에서 타임 아웃기능으로 재전송

  - TCP의 연결 해제
    - 해제하고자 하는 측에서 FIN 전송
    - FIN 수신측에서 보낼 데이터가 있는 경우 계속 송신할 수 있음