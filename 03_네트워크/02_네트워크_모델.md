### 모듈화

- 모듈(module)
  - 독립적으로 동작하면서 상호유기적으로 통합 가능해야 함(적절한 인터페이스 필요)
  - 예) 자동차, 컴퓨터 하드웨어, 객체지향 개념



### 계층화된 모듈 구조

- 상위 계층이 하위 계층에서 제공하는 서비스를 요구하는 방식으로 동작

- 모듈화된 계층 프로토콜 구조의 장점

  - 크고 복잡한 시스템을 작고 간단한 시스템들로 재구성 가능
    - 이해하기 쉽고, 설계 및 구현 용이
  - 모듈이 연동할 수 있는 인터페이스 제공
  - 전송 매체 양단의 호스트가 수행하는 프로토콜은 상호 대칭 관계
  - 각 계층의 오류를 수정하거나 개선하는 경우 전체 시스템의 교체 없이 해당 모듈의 교체로 가능

  

- 프로토콜 설계 시 주요 고려 사항

  - 주소 표현

    - 상대방을 구분할 수 있는 방법 필요
      - 주소 체계
    - 호스트 주소
    - 그룹 주소
      - 브로드캐스트(모든 그룹에 전송)
      - 멀티캐스트(특정 그룹에 전송)

  - 오류 제어

    - 정상, 분실, 변형, 중복

    - ##### 해결 방안은?

      - 응답
        - 응답이 손실되는 경우
      - 타임아웃
        - 타임아웃 후에 도착하는 경우
      - 재전송
        - 재전송이 손실되는 경우
      - 순서번호

  - 흐름 제어

    - 송수신 호스트의 데이터 처리 속도 차이에서 데이터 분실 발생
    - 버퍼(buffer)를 이용하여 완화가 가능하나 버퍼 크기에 제한이 있음
    - 송신 호스트의 전송 속도 조절 필요
    - Ready / Not-ready

  - 데이터 전달 방식

    - 단방향
      - 한쪽 방향으로만 송신
    - 전이중
      - 양쪽이 동시에 송신 가능
    - 반이중
      - 무전기

  

- 서비스의 종류

  - 연결형(미리 길을 탐색하기 때문에 여러 데이터가 같은 길로 갈 수 있다.)
    - 전달 경로를 설정하는 연결 설정 과정 필요
    - 데이터 전송 단계
    - 연결 해제 과정 필요
  - 비연결형(매번 다른 길로 탐색)
    - 연결 설정 및 해제 과정 없이 바로 데이터 전송



- ##### 서비스 프리미티브

  - 기능 요약
    - Request
      - 클라이언트에서 발생
      - 하위 계층에 요구
      - CONNECT.request, DATA.request, DISCONNECT.request
    - Indication
      - 서버에서 발생
      - 클라이언트의 Request가 있었음을 상위 계층에 알림
      - CONNECT.indication, DATA.indication, DISCONNECT.Indication
    - Response
      - 서버에서 발생
      - 클라이언트로 응답
      - CONNECT.response, DATA.response, DISCONNECT.response
    - Confirm
      - 서버에서 보낸 응답을 클라이언트로 통보
      - CONNECT.confirm, DATA. confirm, DISCONNECT. confirm



- ### OSI 7계층 모델

  - 두 개의 호스트가 각각 7계층으로 구성된 모듈을 수행

  - 송신 호스트의 응용계층에서 하위계층으로 순차적으로 (계층마다의 헤더를 붙이며)전달되어 물리계층까지 도달

  - 물리계층을 통해 수신 호스트로 데이터가 이동하고, 순차적으로 상위 계층으로 전달되어 응용계층까지 도달

  - 송신 측에서 하위 계층으로 이동할 때 각 계층 프로토콜에서 정의한 **헤더(header)** 추가

  - 수신 측에서 상위 계층으로 이동할 때 순차적으로 헤더 정보를 처리하고 제거

    

  - 용어 정의

    - 계층n 프로토콜
      - 계층 n 모듈끼리 사용하는 통신 규칙
      - 프로토콜의 역할
        - 프로토콜에서 정의된 기능을 수행하면서 필요한 정보를 서로 교환
        - 예) 주소의 표현, 오류 제어, 흐름 제어 등
    - 동료(peer) 프로세스
      - 동일 계층에 위치한 통신 양단 프로세스
      - 예) 송신 - 데이터링크 계층과 수신 - 데이터링크 계층
    - 인터페이스
      - 상하위 계층 사이의 접속 방법
    - 서비스
      - 상위 계층이 하위 계층을 사용하는 방법



- ### 중계 기능

  - 중계 노드(라우터)의 경우 7계층이 아닌, 네트워크 계층까지의 기능만 수행
  - 라우팅(Routing)
    - 경로배정기능
  - 헤더 정보를 해석하여 적절한 경로로 전달하며, 다음 라우터로 보내기 전에 헤더 정보를 적절히 수정하여 전송



- ### 계층별 기능

  - 물리(physical) 계층

    - 전송 매체의 물리적(기계적, 전기적) 인터페이스에 관한 사항 기술
      - 개별 정보의 비트(bit) 교환 문제
    - 하드웨어(hardware)로 구현
    - 데이터의 전송속도, 클럭(clock) 동기화, 물리적 연결 형태(전선의 두께, 꼬임 형태) 등

    

  - 데이터 링크(data link) 계층

    -  물리계층을 통해 전송하는 데이터의 물리적 전송 오류를 해결하고 흐름 제어 제공

    - **두 개의 노드가 1:1로** 직접 연결된 환경에서 데이터 전송 기능 지원

    - 프레임(frame)

      - 데이터 링크 계층을 통해 전송되는 데이터
      - 헤더에 포함되는 정보
        - MAC 주소
        - 오류 제어에 관련된 추가 정보 (오류 검출 정보, 순서번호)
        - 흐름 제어에 관련된 추가 정보 (버퍼(윈도우)의 크기, Ready/Not ready 플래그 등)
      - 효율적인 처리를 위해 트레일러 (trailer > 패리티, CRC 오류검출)를 이용하기도 함

      

  - 네트워크(network) 계층

    - 네트워크 주소를 기반으로 호스트 간 데이터의 전송 경로를 결정하는 라우팅 문제 처리

      - 전달경로 설정
        - 정적(static) : 사전에 미리 정해진 경로 이용
        - 동적(dynamic) : 네트워크 상황 등을 고려하여 판단

    - 패킷(packet)

      - 네트워크 계층에서의 전송 데이터 명칭

    - 혼잡 제어(congestion control)

      - 네트워크를 이용하여 전송하는 데이터가 과도하게 많은 경우 전송속도가 떨어지는데, 이를 조절

      - 네트워크 계층에서 혼잡제어를 하지 않는 경우 전송계층에서 수행하기도 함

        - 네트워크 계층에서 수행하는 경우와 전송계층에서 수행하는 경우가 어떻게 다른가?

        

  - 전송(transport) 계층

    - 송신 프로세스와 수신 프로세스를 연결하는 단대단(end-to-end) 통신 기능 제공

      - 프로세스를 구별할 수 있는 주소 개념 필요 (예: **포트 번호**)

    - 컴퓨터 내부에서 논리적으로 구축되는 통신 담당자 사이의 문제 처리

      - 전송 속도, 전송 오류, 흐름 제어 등

      

  - 세션(session) 계층

    - 상위적(논리적) 연결 개념인 세션 기능 제공
    - 대화(dialog) 제어
    - 토큰(token) 제어 > 반이중에서 발언권 같은 개념
    - 동기화(synchronization) > 오류가 나서 연결이 종료되었을때 다시 처음부터 전송하지 않는것

    

  - 표현(presentation) 계층

    - 데이터의 의미(semantic)와 표현방법(syntax)을 처리
    - 통신 양단에서 서로 이해할 수 있는 표준 방식으로 코딩(coding) > 번역
    - 암호화/압축 기능도 처리

    

  - 응용(application) 계층

    - 사용자에게 유용한 다양한 서비스
    - 예
      - http(hypertext transfer protocol)
      - ftp(file transfer protocol)
      - telnet
      - e-mail



- ### TCP/IP 구현 환경

  - 시스템 공간
    - TCP/IP와 하위 계층은 운영체제 커널(kernel) 내부에 구현
    - 사용자가 TCP, UDP, IP 기능을 이용할 수 있도록 소켓(socket) 인터페이스 제공 : 인터넷 접속이 가능한 대부분의 호스트에서 지원
    - 하위 계층은 LAN 카드(H/W)와 드라이버 루틴으로 동작
  - 사용자 공간
    - 일반적으로 세션계층부터 응용계층까지의 기능은 사용자 프로그램으로 구현



- ARP(Address Resolution Protocol)
  - 데이터 링크 계층 프로토콜을 이용하여 데이터를 전송하려면 네트워크 주소를 데이터링크 계층 주소(하드웨어 주소)로 변환하여야 함
  - 방송(Broadcast) 기반
  - 경우
    - 동일 망 > 방송 > 모두에게 보내기에 알 수 있다.
    - 다른 망 > 라우터에 보냄 대신 응답
- RARP(**Reverse** Address Resolution Protocol)
  - 호스트의 경우 일반적으로 설정된 자신의 IP 주소를 디스크에 저장
  - 일부 장비는 디스크가 없는 경우가 **있음**
    - X-터미널
      - 고해상도 모니터, 메모리를 갖추고 있으나 파일/폴더는 파일서버를 이용
  - 부팅시 LAN 카드에서 MAC 주소를 알아낸 다음 RARP로 자신의 IP 주소 문의
  - 특정 호스트에서 질의된 MAC에 해당된 IP 주소 반환 
- ICMP(Internet Control Message Protocol)
  - IP 프로토콜에 캡슐화되어 있으나 상위 프로토콜로 보지 않고 동일 계층에 있는 것으로 간주 > 오류 메세지를 전송받는 데 주로 쓰입니다.
  - **ICMP 프로토콜은 Network 계층에 속하며 IP 프로토콜과 같이 사용한다!** 
  - 주요 Control message
    - echo request/reply
    - destination unreachable
    - source quench
    - redirect message
    - alternate host address
    - router advertisement
    - router solicitation
    - time exceeded
    - timestamp
    - parameter problem
    - traceroute